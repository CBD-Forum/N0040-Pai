webpackJsonp([7,0],{0:function(module,exports,t){(function($){"use strict";var e=t(6),n=t(5),o=t(4),i=t(2),a=t(3);t(7),t(8),t(9),t(25);var s=function(){new n.Header("module",".header",function(){$("#top-nav-login").hide(),$("div[class=webNav] .page-title").text("收银台").show()}),new o.Footer("module",".footer")},l=null,r=function(t,e){l=setInterval(function(){t.get("/v1/order?id="+e).then(function(t){if(!t.code){var e=t.data;0!=e.status&&((new a.Toast).show({content:"订单支付成功, 跳转到商户"}),l&&clearInterval(l),window.location.href="/")}})},5e3)},d=function(){var t=new i.RestApi,n=new e.Auth,o=t.getParameter("id");t.get("/v1/order?id="+o).then(function(t){if(t.code)(new a.Toast).show({content:"获取订单信息失败"+t.msg});else{var e=t.data;$("#order-id").text("订单提交成功，请您尽快付款！ 订单号："+e.ordercode),$("#pay-money").text(e.totalprice)}}),$("#weixinpay").on("click",function(){$("#weixinpay").attr({disabled:"disabled"}).addClass("disabled"),t.get("/v1/wxpay/pay?id="+o).then(function(e){if(!e.code){var n=e.data;$("#qrcode").empty(),new QRCode(document.getElementById("qrcode"),n),r(t,o)}$("#weixinpay").removeAttr("disabled").removeClass("disabled")},function(t,e){if(403==t.status)return n.deleteUserInfo(),window.location.href="./login.html?ref="+window.location.href;var o=JSON.parse(t.responseText);2==o.code?$("#weixinpay").attr({disabled:"disabled"}).addClass("disabled"):$("#weixinpay").removeAttr("disabled").removeClass("disabled"),(new a.Toast).show({content:o.msg})})}),$("#quick-payment").on("click",function(e){var i=$("#pay-pwd").val().trim();return null==i||i.length<1?(new a.Toast).show({content:"支付密码不能为空."}):void t.post("/v1/balance/pay",{id:o,password:i}).then(function(e){e.code||r(t,o),$("#quick-payment").removeAttr("disabled").removeClass("disabled")},function(t,e){if(403==t.status)return n.deleteUserInfo(),window.location.href="./login.html?ref="+window.location.href;var o=JSON.parse(t.responseText);2==o.code?$("#quick-payment").attr({disabled:"disabled"}).addClass("disabled"):$("#quick-payment").removeAttr("disabled").removeClass("disabled"),(new a.Toast).show({content:o.msg})})})};$(function(){s(),d()})}).call(exports,t(1))},4:function(module,exports,t){(function($){"use strict";var t=function(){function t(module,t,e){var n=this;this.selector="footer",this.template="",this.className="",this.isSelectorLoaded=!1,this.className=t,this.template="./"+module+"/"+this.selector+".html",$.when($.ajax(this.template)).then(function(o){$(t).html(o),n.isSelectorLoaded=!0,n.init(),e&&e()},function(t){console.log(t)})}return t.prototype.init=function(){},t}();exports.Footer=t}).call(exports,t(1))},5:function(module,exports,t){(function($){"use strict";var e=t(6),n=t(2),o=t(3),i=function(){function t(module,t,i){this.selector="header",this.template="",this.className="",this.isSelectorLoaded=!1,this.auth=new e.Auth,this.toast=new o.Toast,this.restApi=new n.RestApi,this.className=t;var a=this;this.template="./"+module+"/"+this.selector+".html",$.when($.ajax(this.template)).then(function(e){$(t).html(e),a.isSelectorLoaded=!0,i&&i(),a.init()},function(t,e){console.log(e)})}return t.prototype.setLoginStatus=function(t){t?($("#top-nav-login").show(),$("#top-nav-logout").hide(),$("#top-nav-login #login-name").text("您好，"+t)):($("#top-nav-login").hide(),$("#top-nav-logout").show())},t.prototype.init=function(){var t=this,e=this.auth.getUserInfo();if(null==e){var n=this.restApi.getParameter("type");"1"==n?this.restApi.get("/v1/user").then(function(e){var n=null;if(0==e.code){var o=e.data,i=o?o.username:null;i?(t.auth.addUserInfo({userid:o.id,username:i,nickname:o.nickname}),n=o.nickname):console.log(e)}else t.toast.show({content:"登录失败"+e.msg});t.setLoginStatus(n)}):this.setLoginStatus(null)}else this.setLoginStatus(e.nickname);$("#top-nav-login #safety-quit").on("click",function(e){t.restApi.logout().then(function(e){t.auth.deleteUserInfo(),window.location.href="/login.html"},function(e,n){t.auth.deleteUserInfo(),window.location.href="/login.html"})})},Object.defineProperty(t.prototype,"auth1",{get:function(){return this.auth},set:function(t){this.auth=t},enumerable:!0,configurable:!0}),t}();exports.Header=i}).call(exports,t(1))},8:7,25:7});
//# sourceMappingURL=pay-054c9cd9.js.map