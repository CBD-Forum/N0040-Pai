webpackJsonp([10,0],{0:function(module,exports,t){(function($){"use strict";var e=t(3),n=t(5),i=t(4),o=t(6),s=t(2);t(7),t(9),t(22);var a=new o.Auth,l=function(){$(".login-btn").on("click",function(t){r()}),$("#login-pwd").on("keydown",function(t){var e=t.which;13==e&&r()}),$.when($.getJSON("./asset/config/config.json")).then(function(t){if(t.thirdParty.jingtum&&t.thirdParty.jingtum.length>0){var e=t.thirdParty.jingtum,n=new s.RestApi,i=n.getParameter("ref");i&&(e+=e.lastIndexOf("?")>0?"&next="+i:"?next="+i),$("#login-jingtum").attr({href:e})}t.thirdParty.weixin&&t.thirdParty.weixin.length>0&&$("#login-wechat").attr({href:t.thirdParty.weixin})},function(t){console.log(t)})},r=function(){var t=$("div[class=login-box] #login-name").val().trim(),n=$("div[class=login-box] #login-pwd").val().trim();if((null==t||t.length<1)&&(null==n||n.length<1))$("div[class=login-box] .msg-error").show().text("请输入帐号和密码");else if(null==t||t.length<1)$("div[class=login-box] .msg-error").show().text("请输入帐号");else if(null==n||n.length<1)$("div[class=login-box] .msg-error").show().text("请输入密码");else{var i={username:t,password:n};$(".login-btn").attr({disabled:"disabled"}).addClass("disabled");var o=new s.RestApi;o.login(i).then(function(t){if(t.code)return $(".login-btn").removeAttr("disabled").removeClass("disabled"),(new e.Toast).show({content:t.msg});var n=t.data;a.addUserInfo({userid:n.id,username:n.username,nickname:n.nickname});var i=o.getParameter("ref");i?window.location.href=i:window.location.href="/index.html",$(".login-btn").removeAttr("disabled").removeClass("disabled")},function(t){t.responseJSON&&t.responseJSON.code&&(new e.Toast).show({content:t.responseJSON.msg}),$(".login-btn").removeAttr("disabled").removeClass("disabled")})}},h=function(){new n.Header("module",".header",function(t){$("div[class=webNav] ul").hide(),$("#top-nav-login").hide(),$(".header").css({border:"none"}),$("div[class=webNav] .page-title").text("欢迎登录").show()}),new i.Footer("module",".footer");a.deleteUserInfo()};$(function(){l(),h()})}).call(exports,t(1))},4:function(module,exports,t){(function($){"use strict";var t=function(){function t(module,t,e){var n=this;this.selector="footer",this.template="",this.className="",this.isSelectorLoaded=!1,this.className=t,this.template="./"+module+"/"+this.selector+".html",$.when($.ajax(this.template)).then(function(i){$(t).html(i),n.isSelectorLoaded=!0,n.init(),e&&e()},function(t){console.log(t)})}return t.prototype.init=function(){},t}();exports.Footer=t}).call(exports,t(1))},5:function(module,exports,t){(function($){"use strict";var e=t(6),n=t(2),i=t(3),o=function(){function t(module,t,o){this.selector="header",this.template="",this.className="",this.isSelectorLoaded=!1,this.auth=new e.Auth,this.toast=new i.Toast,this.restApi=new n.RestApi,this.className=t;var s=this;this.template="./"+module+"/"+this.selector+".html",$.when($.ajax(this.template)).then(function(e){$(t).html(e),s.isSelectorLoaded=!0,o&&o(),s.init()},function(t,e){console.log(e)})}return t.prototype.setLoginStatus=function(t){t?($("#top-nav-login").show(),$("#top-nav-logout").hide(),$("#top-nav-login #login-name").text("您好，"+t)):($("#top-nav-login").hide(),$("#top-nav-logout").show())},t.prototype.init=function(){var t=this,e=this.auth.getUserInfo();if(null==e){var n=this.restApi.getParameter("type");"1"==n?this.restApi.get("/v1/user").then(function(e){var n=null;if(0==e.code){var i=e.data,o=i?i.username:null;o?(t.auth.addUserInfo({userid:i.id,username:o,nickname:i.nickname}),n=i.nickname):console.log(e)}else t.toast.show({content:"登录失败"+e.msg});t.setLoginStatus(n)}):this.setLoginStatus(null)}else this.setLoginStatus(e.nickname);$("#top-nav-login #safety-quit").on("click",function(e){t.restApi.logout().then(function(e){t.auth.deleteUserInfo(),window.location.href="/login.html"},function(e,n){t.auth.deleteUserInfo(),window.location.href="/login.html"})})},Object.defineProperty(t.prototype,"auth1",{get:function(){return this.auth},set:function(t){this.auth=t},enumerable:!0,configurable:!0}),t}();exports.Header=o}).call(exports,t(1))},22:7});
//# sourceMappingURL=login-e3c90021.js.map